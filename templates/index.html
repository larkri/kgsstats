<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KGS Stats</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Extra styling to keep chart aspect ratio */
    .chart-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: auto;
    }

    /* Flex container for stats and chart side by side */
    .stats-flex {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 40px;
      margin-top: 20px;
    }

    .stats-box {
      min-width: 280px;
      max-width: 400px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>KGS Player Statistics</h1>
    <form method="POST">
      <label for="username">Player username:</label><br />
      <input type="text" id="username" name="username" required /><br /><br />

      <label for="opponent">Opponent username (optional):</label><br />
      <input type="text" id="opponent" name="opponent" /><br /><br />

      <button type="submit">Get Statistics</button>
    </form>

    {% if error %}
      <p class="error">{{ error }}</p>
    {% endif %}

    {% if stats %}
      <div class="stats-flex">
        <div class="stats-box">
          <h2>Statistics for {{ stats.player_name }}</h2>
          <p><strong>Total games played:</strong> {{ stats.total_matches }}</p>
          <p><strong>Wins:</strong> {{ stats.wins }}</p>
          <p><strong>Losses:</strong> {{ stats.losses }}</p>
          <p><strong>Win ratio:</strong> {{ stats.win_ratio }}%</p>
          <div class="chart-container">
            <canvas id="playerChart"></canvas>
          </div>
        </div>

        {% if h2h_stats %}
        <div class="stats-box">
          <h2>Head-to-Head: {{ stats.player_name }} vs {{ stats.opponent_name }}</h2>
          <p><strong>Total games played:</strong> {{ h2h_stats.total_matches }}</p>
          <p><strong>{{ stats.player_name }} wins:</strong> {{ h2h_stats.player_wins }}</p>
          <p><strong>{{ stats.opponent_name }} wins:</strong> {{ h2h_stats.opponent_wins }}</p>
          <p><strong>Draws:</strong> {{ h2h_stats.draws }}</p>
          <p><strong>Win ratio for {{ stats.player_name }}:</strong> {{ h2h_stats.win_ratio }}%</p>
          <div class="chart-container">
            <canvas id="h2hChart"></canvas>
          </div>
        </div>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <script>
    {% if stats %}
    const playerCtx = document.getElementById('playerChart').getContext('2d');
    const playerChart = new Chart(playerCtx, {
      type: 'doughnut',
      data: {
        labels: ['Wins', 'Losses'],
        datasets: [{
          label: 'Player Results',
          data: [{{ stats.wins }}, {{ stats.losses }}],
          backgroundColor: ['#4CAF50', '#F44336'],
          hoverOffset: 10
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { position: 'bottom' },
          title: {
            display: true,
            text: 'Win / Loss Ratio'
          }
        }
      }
    });
    {% endif %}

    {% if h2h_stats %}
    const h2hCtx = document.getElementById('h2hChart').getContext('2d');
    const h2hChart = new Chart(h2hCtx, {
      type: 'doughnut',
      data: {
        labels: ['{{ stats.player_name }} Wins', '{{ stats.opponent_name }} Wins', 'Draws'],
        datasets: [{
          label: 'Head-to-Head Results',
          data: [{{ h2h_stats.player_wins }}, {{ h2h_stats.opponent_wins }}, {{ h2h_stats.draws }}],
          backgroundColor: ['#4CAF50', '#F44336', '#FFC107'],
          hoverOffset: 10
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { position: 'bottom' },
          title: {
            display: true,
            text: 'Head-to-Head Win Ratio'
          }
        }
      }
    });
    {% endif %}
  </script>
</body>
</html>
